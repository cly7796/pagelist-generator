javascript:(function(){const host=location.host;const urlList=[];let pageCounter=0;const get_pagedata=async(pageUrl)=>{update_counter();const result=await fetch(pageUrl);const text=await result.text();if(result.ok){let parser=new DOMParser();let doc=parser.parseFromString(text,'text/html');urlList[pageCounter].status=result.status;urlList[pageCounter].title=doc.title;get_linklist(doc);console.log('URL:',pageUrl,'COUNT:',(pageCounter+1)+'/'+urlList.length,'TITLE:',doc.title,'STATUS:',result.status)}else{urlList[pageCounter].status=result.status;console.log('URL:',pageUrl,'COUNT:',(pageCounter+1)+'/'+urlList.length,'STATUS:',result.status)}pageCounter++;if(pageCounter>=urlList.length){generate_result();return}setTimeout(function(){get_pagedata(urlList[pageCounter]['url'])},1000)};const get_linklist=(doc)=>{const links=doc.querySelectorAll('a');for(let i=0;i<links.length;i++){const link=adjust_link(links[i]);if(!search_urlList(link)&&link.indexOf(host)>-1){urlList.push({title:'',url:link,status:''});update_counter()}}};const adjust_link=(a)=>{let href=a.getAttribute('href');if(href===null){href=''}else if(href.slice(0,7)==='mailto:'||href.slice(0,4)==='tel:'){href=''}const url=new URL(href,urlList[pageCounter].url);return adjust_url(url.href)};const adjust_url=(url)=>{let adjustUrl=url.split('#')[0].split('?')[0];const dirs=adjustUrl.split('/');const lastDir=dirs[dirs.length-1];if(lastDir!==''){if(lastDir.indexOf('.')===-1){adjustUrl=adjustUrl+'/'}else{adjustUrl=adjustUrl.replace('index.html','')}}return adjustUrl};const search_urlList=(url)=>{for(let i=0;i<urlList.length;i++){if(urlList[i].url===url)return true}return false};const update_counter=()=>{const current=document.getElementById('pagelist-generator-counter-current');const total=document.getElementById('pagelist-generator-counter-total');current.innerText=pageCounter+1;total.innerText=urlList.length};const generate_controller=()=>{const bar=document.createElement('div');const barStyle=`position:absolute;top:0;left:0;width:100%;background:black;`;bar.setAttribute('style',barStyle);const counterStyle=`color:white;padding:10px;`;const counter=`<div style="${counterStyle}"><span id="pagelist-generator-counter-current">0</span><span>/</span><span id="pagelist-generator-counter-total">0</span></div>`;bar.innerHTML=counter;document.body.appendChild(bar)};const generate_result=()=>{console.table(urlList);let res='';let c=0;for(let i=0;i<urlList.length;i++){if(200<=urlList[i].status&&urlList[i].status<=299){res+=urlList[i].title+'	'+urlList[i].url+'\n';c++}}console.log(c+'件のURLを取得しました');console.log(res)};urlList.push({title:document.title,url:adjust_url(location.href),status:''});generate_controller();get_pagedata(urlList[pageCounter]['url'])})()